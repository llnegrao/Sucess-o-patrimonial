<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Análise da Sucessão Patrimonial</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2563eb;
            --primary-light: #60a5fa;
            --success: #22c55e;
            --warning: #fbbf24;
            --danger: #ef4444;
            --gray-100: #f9fafb;
            --gray-200: #f3f4f6;
            --gray-300: #e5e7eb;
            --gray-400: #9ca3af;
            --gray-600: #4b5563;
            --gray-900: #111827;
            --white: #fff;
        }
        html {
            box-sizing: border-box;
        }
        *, *:before, *:after {
            box-sizing: inherit;
        }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: var(--gray-100);
            color: var(--gray-900);
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 24px 16px 32px 16px;
        }
        h1 {
            color: var(--primary);
            font-size: 2.1rem;
            font-weight: 700;
            margin-bottom: 32px;
            text-align: center;
            letter-spacing: -0.5px;
        }
        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: auto auto;
            gap: 32px 24px;
            margin-bottom: 40px;
        }
        .chart-panel {
            background: var(--white);
            border-radius: 16px;
            box-shadow: 0 4px 16px 0 rgba(60, 72, 94, 0.10);
            border: 1px solid var(--gray-200);
            padding: 18px 12px 22px 12px;
            display: flex;
            flex-direction: column;
            align-items: stretch;
            min-width: 0;
        }
        .chart-panel h2 {
            font-size: 1.16rem;
            font-weight: 600;
            color: var(--primary);
            margin: 0 0 18px 0;
            text-align: center;
        }
        .chart-panel .chart-subtitle {
            font-size: 1rem;
            color: var(--gray-600);
            margin-bottom: 12px;
            text-align: center;
        }
        .chart-container {
            position: relative;
            flex: 1;
            min-height: 260px;
            max-height: 330px;
        }

        /* Restante do layout (cartões, grid, alertas, tabela, fluxo) */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }
        .card {
            background: var(--white);
            border-radius: 16px;
            box-shadow: 0 4px 16px 0 rgba(60, 72, 94, 0.10);
            border: 1px solid var(--gray-200);
            padding: 24px 20px 22px 20px;
            transition: box-shadow .18s;
        }
        .card:hover {
            box-shadow: 0 6px 24px 0 rgba(60, 72, 94, 0.16);
        }
        .card h3 {
            margin: 0 0 16px 0;
            color: var(--primary);
            font-size: 1.1rem;
            font-weight: 600;
            letter-spacing: -0.2px;
        }
        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--gray-200);
        }
        .metric:last-child {
            border-bottom: none;
        }
        .metric-label {
            color: var(--gray-600);
            font-size: 0.97rem;
        }
        .metric-value {
            font-weight: 600;
            font-size: 1.07rem;
        }
        .positive {
            color: var(--success);
        }
        .negative {
            color: var(--danger);
        }
        .neutral {
            color: var(--primary-light);
        }
        .warning, .critical {
            background: var(--warning);
            color: var(--gray-900);
            border-radius: 10px;
            border: 1px solid #f59e42;
            padding: 18px 18px 12px 18px;
            margin: 28px 0 24px 0;
            box-shadow: 0 1px 6px 0 rgba(251,191,36,0.10);
        }
        .critical {
            background: #fee2e2;
            border: 1px solid #fca5a5;
        }
        .warning h4, .critical h4 {
            color: var(--danger);
            margin: 0 0 8px 0;
            font-size: 1.05rem;
            font-weight: 700;
        }
        .warning p, .critical p {
            color: var(--gray-900);
            margin: 6px 0;
            font-size: 0.98rem;
            line-height: 1.6;
        }
        .flow-diagram {
            background: var(--white);
            border-radius: 14px;
            border: 1px solid var(--gray-200);
            padding: 22px 16px 17px 16px;
            margin: 32px 0 18px 0;
            box-shadow: 0 2px 9px 0 rgba(60, 72, 94, 0.08);
        }
        .flow-diagram h3 {
            margin: 0 0 19px 0;
            color: var(--primary);
            font-size: 1rem;
            font-weight: 700;
        }
        .flow-step {
            display: flex;
            align-items: flex-start;
            margin: 14px 0;
            padding: 13px;
            background: var(--gray-100);
            border-radius: 8px;
            border: 1px solid var(--gray-200);
        }
        .flow-step-number {
            width: 32px;
            height: 32px;
            background: var(--primary);
            color: var(--white);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.1rem;
            margin-right: 12px;
            flex-shrink: 0;
            box-shadow: 0 1px 6px 0 rgba(37,99,235,0.10);
        }
        .flow-step-content {
            flex: 1;
        }
        .flow-step-title {
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 4px;
            font-size: 1rem;
        }
        .flow-step-desc {
            color: var(--gray-600);
            font-size: 0.95rem;
        }
        .table-container {
            overflow-x: auto;
            margin: 18px 0 10px 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: var(--white);
            border-radius: 8px;
            overflow: hidden;
            min-width: 580px;
        }
        th, td {
            padding: 13px 10px;
            text-align: left;
            border-bottom: 1px solid var(--gray-200);
            font-size: 0.98rem;
        }
        th {
            background: var(--gray-200);
            color: var(--primary);
            font-weight: 600;
            font-size: 0.95rem;
        }
        td {
            color: var(--gray-900);
        }
        tr:hover {
            background: var(--gray-100);
        }

        /* MOBILE */
        @media (max-width: 900px) {
            .charts-grid {
                grid-template-columns: 1fr;
                gap: 22px 0;
            }
        }
        @media (max-width: 768px) {
            h1 {
                font-size: 1.32rem;
                margin-bottom: 20px;
            }
            .container {
                padding: 14px 3vw 24px 3vw;
            }
            .grid {
                grid-template-columns: 1fr;
                gap: 14px;
            }
            .card {
                padding: 13px 10px 15px 10px;
            }
            .flow-diagram {
                padding: 11px 6px 12px 6px;
            }
            .flow-step {
                padding: 8px;
                margin: 8px 0;
            }
            .flow-step-number {
                width: 26px;
                height: 26px;
                font-size: 0.98rem;
            }
            .table-container {
                margin: 9px 0 8px 0;
            }
            table {
                font-size: 0.92rem;
                min-width: 420px;
            }
            th, td {
                padding: 8px 6px;
            }
            .chart-container {
                min-height: 140px;
                max-height: 180px;
            }
            .charts-grid {
                gap: 14px 0;
            }
        }
        @media (hover: none) and (pointer: coarse) {
            .card:active {
                box-shadow: 0 4px 16px 0 rgba(60, 72, 94, 0.18);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Análise da Sucessão Patrimonial e Adiantamento</h1>

        <!-- NOVA SESSÃO DE GRÁFICOS EM GRADE 2x2, RECRIANDO OS DA IMAGEM -->
        <div class="charts-grid">
            <div class="chart-panel">
                <h2>1. Distribuição Original da Previdência (Brasilprev)</h2>
                <div class="chart-subtitle">Valor Estimado (R$)</div>
                <div class="chart-container">
                    <canvas id="chart1"></canvas>
                </div>
            </div>
            <div class="chart-panel">
                <h2>2. Composição do Adiantamento de R$ 200.000,00 para Rose</h2>
                <div class="chart-container">
                    <canvas id="chart2"></canvas>
                </div>
            </div>
            <div class="chart-panel">
                <h2>3. Nova Distribuição da Previdência (Após Compensação)</h2>
                <div class="chart-subtitle">Novo Valor Estimado (R$)</div>
                <div class="chart-container">
                    <canvas id="chart3"></canvas>
                </div>
            </div>
            <div class="chart-panel">
                <h2>4. Ganho Adicional na Brasilprev para os Outros 5 Herdeiros</h2>
                <div class="chart-subtitle">Valor do Ganho (R$)</div>
                <div class="chart-container">
                    <canvas id="chart4"></canvas>
                </div>
            </div>
        </div>

        <!-- RESTANTE DO CONTEÚDO COMO NA PÁGINA MODERNA ANTERIOR -->
        <div class="critical">
            <h4>⚠️ Pontos Críticos da Operação</h4>
            <p>• <strong>Liquidez assimétrica:</strong> Rose recebe R$ 200.000 em dinheiro HOJE. Os demais herdeiros recebem apenas R$ 12.452 em direitos futuros na Brasilprev.</p>
            <p>• <strong>Valor temporal do dinheiro ignorado:</strong> R$ 200.000 hoje não equivalem a R$ 200.000 futuros. A operação não considera juros ou correção monetária.</p>
            <p>• <strong>Risco de resgate:</strong> A compensação dos outros herdeiros depende da manutenção integral da Brasilprev até o resgate.</p>
            <p>• <strong>Tributação diferenciada:</strong> Rose pode ter vantagens fiscais ao antecipar o recebimento versus o resgate futuro da previdência.</p>
        </div>

        <div class="flow-diagram">
            <h3>Fluxo da Operação</h3>
            <div class="flow-step">
                <div class="flow-step-number">1</div>
                <div class="flow-step-content">
                    <div class="flow-step-title">Rose solicita R$ 200.000</div>
                    <div class="flow-step-desc">Necessidade imediata de capital para compra de apartamento</div>
                </div>
            </div>
            <div class="flow-step">
                <div class="flow-step-number">2</div>
                <div class="flow-step-content">
                    <div class="flow-step-title">Consumo total da cota na Casa Santos</div>
                    <div class="flow-step-desc">R$ 137.741 (100% de sua parte) + R$ 62.259 da Brasilprev</div>
                </div>
            </div>
            <div class="flow-step">
                <div class="flow-step-number">3</div>
                <div class="flow-step-content">
                    <div class="flow-step-title">Redistribuição na Brasilprev</div>
                    <div class="flow-step-desc">Rose fica com 9,03% (era 16,67%). Outros passam para 18,19% cada</div>
                </div>
            </div>
        </div>

        <div class="card">
            <h3>Análise Comparativa por Herdeiro</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Herdeiro</th>
                            <th>Cota Original Total</th>
                            <th>Valor Recebido/Antecipado</th>
                            <th>Saldo Remanescente</th>
                            <th>Diferença Real</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Rose</strong></td>
                            <td>R$ 273.630</td>
                            <td class="negative">R$ 200.000 (hoje)</td>
                            <td>R$ 73.630</td>
                            <td class="negative">-R$ 126.370 de direitos futuros</td>
                        </tr>
                        <tr>
                            <td>Outros (cada)</td>
                            <td>R$ 273.630</td>
                            <td class="positive">R$ 12.452 (futuro)</td>
                            <td>R$ 286.082</td>
                            <td class="positive">+R$ 12.452 em direitos futuros</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="warning">
            <h4>Questões Jurídicas e Fiscais</h4>
            <p>• A operação precisa ser formalizada adequadamente para evitar questionamentos futuros sobre doação ou adiantamento de legítima.</p>
            <p>• Verificar implicações do ITCMD (Imposto sobre Transmissão Causa Mortis e Doação) nesta antecipação.</p>
            <p>• Documentar expressamente o acordo entre todos os herdeiros para evitar litígios.</p>
            <p>• Considerar a necessidade de averbação ou registro formal da operação.</p>
        </div>
    </div>

    <script>
        // CHART 1 - Distribuição Original da Previdência (Brasilprev)
        const ctx1 = document.getElementById('chart1').getContext('2d');
        new Chart(ctx1, {
            type: 'bar',
            data: {
                labels: ['Rose', 'Herdeiro 1', 'Herdeiro 2', 'Herdeiro 3', 'Herdeiro 4', 'Herdeiro 5'],
                datasets: [{
                    label: 'Valor Estimado (R$)',
                    data: [135889.29, 135889.29, 135889.29, 135889.29, 135889.29, 135889.29],
                    backgroundColor: '#7fd3fa',
                    borderColor: '#94c6eb',
                    borderWidth: 2,
                    borderRadius: 6,
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return 'R$ ' + context.parsed.y.toLocaleString('pt-BR', {minimumFractionDigits: 2});
                            }
                        }
                    },
                    datalabels: false
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Valor Estimado (R$)',
                            color: '#666',
                            font: { size: 13 }
                        },
                        ticks: {
                            callback: function(value) {
                                return 'R$ ' + value.toLocaleString('pt-BR', {maximumFractionDigits: 0});
                            },
                            color: '#a3a3a3'
                        },
                        grid: { color: '#f3f4f6' }
                    },
                    x: {
                        ticks: { color: '#6b7280' },
                        grid: { display: false }
                    }
                }
            },
            plugins: [{
                afterDatasetsDraw: function(chart) {
                    const ctx = chart.ctx;
                    chart.data.datasets.forEach(function(dataset, i) {
                        const meta = chart.getDatasetMeta(i);
                        meta.data.forEach(function(bar, index) {
                            const value = dataset.data[index];
                            ctx.save();
                            ctx.font = 'bold 12px Inter,Arial,sans-serif';
                            ctx.fillStyle = '#222';
                            ctx.textAlign = 'center';
                            ctx.textBaseline = 'bottom';
                            ctx.fillText('R$ ' + value.toLocaleString('pt-BR', {minimumFractionDigits: 2}), bar.x, bar.y - 4);
                            ctx.restore();
                        });
                    });
                }
            }]
        });

        // CHART 2 - Composição do Adiantamento de R$ 200.000,00 para Rose
        const ctx2 = document.getElementById('chart2').getContext('2d');
        new Chart(ctx2, {
            type: 'pie',
            data: {
                labels: [
                    'Cota da Venda da Casa\nR$ 137.741,17',
                    'Retirada da Brasilprev\nR$ 62.258,83'
                ],
                datasets: [{
                    data: [137741.17, 62258.83],
                    backgroundColor: [
                        'rgba(34, 197, 94, 0.4)',
                        'rgba(251, 191, 36, 0.8)'
                    ],
                    borderColor: [
                        'rgba(34, 197, 94, 1)',
                        'rgba(251, 191, 36, 1)'
                    ],
                    borderWidth: 3
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: { color: '#444', font: { size: 13 } }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const value = context.parsed;
                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                const perc = ((value / total) * 100).toFixed(1);
                                return context.label.replace('\n', ': ') + ' (' + perc + '%)';
                            }
                        }
                    }
                }
            }
        });

        // CHART 3 - Nova Distribuição da Previdência (Após Compensação)
        const ctx3 = document.getElementById('chart3').getContext('2d');
        new Chart(ctx3, {
            type: 'bar',
            data: {
                labels: ['Rose', 'Herdeiro 1', 'Herdeiro 2', 'Herdeiro 3', 'Herdeiro 4', 'Herdeiro 5'],
                datasets: [{
                    label: 'Novo Valor Estimado (R$)',
                    data: [73630.46, 148341.05, 148341.05, 148341.05, 148341.05, 148341.05],
                    backgroundColor: function(ctx) {
                        return ctx.dataIndex === 0 ? '#f87171' : '#22c55e';
                    },
                    borderColor: function(ctx) {
                        return ctx.dataIndex === 0 ? '#ef4444' : '#22c55e';
                    },
                    borderWidth: 2,
                    borderRadius: 6,
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return 'R$ ' + context.parsed.y.toLocaleString('pt-BR', {minimumFractionDigits: 2});
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Novo Valor Estimado (R$)',
                            color: '#666',
                            font: { size: 13 }
                        },
                        ticks: {
                            callback: function(value) {
                                return 'R$ ' + value.toLocaleString('pt-BR', {maximumFractionDigits: 0});
                            },
                            color: '#a3a3a3'
                        },
                        grid: { color: '#f3f4f6' }
                    },
                    x: {
                        ticks: { color: '#6b7280' },
                        grid: { display: false }
                    }
                }
            },
            plugins: [{
                afterDatasetsDraw: function(chart) {
                    const ctx = chart.ctx;
                    chart.data.datasets.forEach(function(dataset, i) {
                        const meta = chart.getDatasetMeta(i);
                        meta.data.forEach(function(bar, index) {
                            const value = dataset.data[index];
                            ctx.save();
                            ctx.font = 'bold 12px Inter,Arial,sans-serif';
                            ctx.fillStyle = '#222';
                            ctx.textAlign = 'center';
                            ctx.textBaseline = 'bottom';
                            ctx.fillText('R$ ' + value.toLocaleString('pt-BR', {minimumFractionDigits: 2}), bar.x, bar.y - 4);
                            ctx.restore();
                        });
                    });
                }
            }]
        });

        // CHART 4 - Ganho Adicional na Brasilprev para os Outros 5 Herdeiros
        const ctx4 = document.getElementById('chart4').getContext('2d');
        new Chart(ctx4, {
            type: 'bar',
            data: {
                labels: ['Herdeiro 1', 'Herdeiro 2', 'Herdeiro 3', 'Herdeiro 4', 'Herdeiro 5'],
                datasets: [{
                    label: 'Valor do Ganho (R$)',
                    data: [12451.77, 12451.77, 12451.77, 12451.77, 12451.77],
                    backgroundColor: '#22c55e',
                    borderColor: '#16a34a',
                    borderWidth: 2,
                    borderRadius: 6,
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return 'R$ ' + context.parsed.y.toLocaleString('pt-BR', {minimumFractionDigits: 2});
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 16000,
                        title: {
                            display: true,
                            text: 'Valor do Ganho (R$)',
                            color: '#666',
                            font: { size: 13 }
                        },
                        ticks: {
                            callback: function(value) {
                                return 'R$ ' + value.toLocaleString('pt-BR', {maximumFractionDigits: 0});
                            },
                            color: '#a3a3a3'
                        },
                        grid: { color: '#f3f4f6' }
                    },
                    x: {
                        ticks: { color: '#6b7280' },
                        grid: { display: false }
                    }
                }
            },
            plugins: [{
                afterDatasetsDraw: function(chart) {
                    const ctx = chart.ctx;
                    chart.data.datasets.forEach(function(dataset, i) {
                        const meta = chart.getDatasetMeta(i);
                        meta.data.forEach(function(bar, index) {
                            const value = dataset.data[index];
                            ctx.save();
                            ctx.font = 'bold 12px Inter,Arial,sans-serif';
                            ctx.fillStyle = '#222';
                            ctx.textAlign = 'center';
                            ctx.textBaseline = 'bottom';
                            ctx.fillText('R$ ' + value.toLocaleString('pt-BR', {minimumFractionDigits: 2}), bar.x, bar.y - 4);
                            ctx.restore();
                        });
                    });
                }
            }]
        });
    </script>
</body>
</html>